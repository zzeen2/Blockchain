# p2p
> 한줄요약 : 클라이언트이자 서버(네트워크 구조가 있다.)
> 중앙 서버가 아닌, 개개인이 클라이언트이자 서버가 될 수 있다.
> 웹의 발전과 함께 중앙 서버 중심의 구조가 많이 정착되었다.
> 이후 최초의 p2p 파일 공유 시스템 넵스터. 음악을 사용자가 개인간에 공유할 수 있도록
> 비트 토렌트. 파일을 여러조각으로 나눠서 사용자들이 파일을 전송하고 다운로드 받을 수 있었다.
> 비트코인 백서 발표 블록체인의 p2p 네트워크 기반으로 화폐 장부 관리의 형태를 제안
> 비트코인 p2p 네트워크에 구축된 분산 원장 시스템을 설계해서 안전하게 개인간의 거래를 제공한다.

### p2p 네트워크의 구성
> 분산된 피어를 가지고 제어한다.
> 중앙 서버에서는 해킹이나 서버가 터지면 모든 사용자가 이용을 못하는 상황이 발생한다. 
> 일부의 노드의 피어가 잘못되어도 다른 사용자가 네트워크를 이용하지 못하는 경우는 발생하지 않는다. 
> p2p 네트워크의 단점이자 확장성 노드가 사용자가 중요하다. (빠르고 정확하고 안전하다.) 사용자도 많고
> 생태계가 활성화되어서 네트워크의 상태가 복잡한 네트워크가 좋은 네트워크 속도가 느리다는 것은 보안성이 좋다는 것

### p2p 네트워크란
> 네트워크는 여러 대의 컴퓨터가 서로 통신을 하면서 데이터를 주고 받는 형태 
> 우리가 사용하는 인터넷도 데이터를 요청 응답받는 형태를 가지고 있는 네트워크
> peer-to-peer의 약어이고, 컴퓨터 중앙 서버가 없고 컴퓨터 간의 직접 통신을 지향해서 두 컴퓨터 간의 데이터를 주고받는 네트워크. 이 네트워크에서 peer는 다른 컴퓨터로 생각을 하면된다.
> 중앙 서버에서 따로 관리하는 데이터가 아닌 컴퓨터간에 서로 클라이언트이자 서버가 되어서 데이터를 주고받는 방식

#### 기존에 사용하던 네트워크의 형태는
- 클라이언트와 서버의 구조
    > 중앙 서버가 있고, 사용자들이 서버에 요청을 보내면 데이터를 응답 받아서 사용하거나 요청 데이터를 받아서 저장을 해서 웹사이트를 구현했다. 
    > 단점은 서버가 다운되면 전체 웹서비스가 중단된다. (서버를 여러개를 관리하는 형태로)(로드벨런서)

- p2p의 구조
    > 각 컴퓨터가 서버와 클라이언트의 역할을 둘다 해서 직접 데이터를 통신한다.
    > 중앙 서버가 없고, 서로 간의 클라이언트 서버 역할을 해서 하나의 컴퓨터가 마비되더라도, 네트워크는 안전하다. 전체 컴퓨터가 동시에 마비되지 않는 이상

(잘된 web2 환경에서 발전하다가 더이상 발전할게 없다. web3는 접근성이 떨어진다.)

#### p2p 동작
1. 네트워크의 참여자(노드)
    > p2p 네트워크에 참여하는 노드들을 활성화
    > 각 노드는 네트워크에 접속해서 데이터를 요청 응답을 받고 네트워크를 유지

2. 데이터의 통신
    > 노드는 서로 직접 통신을 지향해서 데이터를 주고받는다. 
    > 클라이언트이자 서버 내가 데이터를 요청. 상대방에게 데이터를 응답 할 수 있는 형태

3. 데이터의 분산 저장
    > 각 노드는 데이터를 서로 저장하고 있고
    > 노드 하나의 데이터가 문제가 생기더라도 다른 노드가 데이터를 검증 관리 하고 있기 때문에 안전하다.

4. 네트워크의 유지
    > 노드들은 네트워크의 상태를 유지하고 검증하고 관리한다. 새로운 노드가 생태계에 입장하면 데이터를 주고받아서 노드의 데이터를 업데이트한다.
    > 중앙 서버가 없어도 노드들간의 네트워크를 관리 유지 검증을 통해서 자율적으로 동작하는 구조다.

#### 블록체인의 p2p 네트워크
> 데이터가 저장되는 형태의 블록 단위를 체인의 형태로 저장하는 분산 장부를
> 네트워크에서 참여하는 모든 노드가 서로 데이터를 가지고 있고, 검증을 서로 데이터를 주고 받으면서
> 검증을 하는 형태를 설계 블록체인에서 p2p 네트워크를 사용하는 목적 - 중앙서버에서 관리하는 형태가 아닌
> 중앙서버는 블록체인의 사상에 어긋난다. p2p 개인간의 데이터를 주고받는 형태의 네트워크 구조를 선택
> p2p 네트워크에서 노드는 언제든지 참여가 가능하고 퇴장도 가능한 자율적인 구조를 제공한다.

#### 특징
- 분산성 : 노드간에 분산된 장부를 관리하고있다.
- 신뢰성 : 데이터의 검증은 모든 노드가 데이터를 주고받아서 하고 있는 형태이기 때문에 위변조가 불가능하다.
- 투명성 : 모든 저장된 데이터는 누구나 조회가 가능하다.(모두가 자금의 이동을 투명하게 볼 수 있는 구조를 제공)
- 검증과 합의 : 노드들은 합의 알고리즘을 사용해서 거래의 내용을 검증하고 장부에 기록해서 저장한다.

#### 브로드캐스트 과정 예
1. A 노드가 새로운 거래를 생성했다. A -> B (10비트)
2. B 노드가 마이닝을 할때 A노드의 거래내용을 포함시켜서 마이닝에 성공. 다른 노드들에게 블록생성 검증
3. 검증된 블록은 p2p 네트워크를 통해서 다른 노드들 즉 B 노드 연결되어있는 노드들 생성한 블록을 전파
4. 다른 노드들은 생성한 블록을 받아서 유효성 검증을 한 뒤에 본인의 장부에 블록을 추가한다.
5. 노드가 데이터를 공유해서 장부를 업데이트 즉 동기화를 시켜서 하나의 장부를 유지시키는 목적을 가지고 있다.

#### p2p 목적
1. 중앙 기관 없이 신뢰성을 만들겠다. : 개인간의 신뢰를 구축하겠다.
2. 보안과 투명성 : 각각의 노드들이 제 3자가 되어서 검증자가 되어주는 형태. 모두가 자금의 이동을 투명하게 볼 수 있도록 제공 
3. 네트워크의 유지 : 중앙서버가 없으니 서버에 장애가 발생하더라도 네트워크가 유지될 수 있다. 

### p2p server 구현
> 지금까지 구성한 블록체인 구조를 가지고
> 하나의 노드를 만들어서 피어의 리스트는 (실제로는 네트워크에서 노드의 리스트를 제공해서 연결성을 가지게 해주는데,) 우리는 화이파이 혹은 랜선 같은 네트워크에 있는 컴퓨터 끼리 피어 연결을 해서 데이터를 주고받자

#### 단계
1. 지갑 생성
2. 트랜잭션 생성
3. mempool에 트랜잭션 등록
4. p2p 전파 (거래가 생성되었다는 것을 알려야 한다.)
5. 블록 생성 마이닝
6. 블록 전파. 다른 노드가 검증
7. 체인 업데이트
8. UTXO 내용 반영

