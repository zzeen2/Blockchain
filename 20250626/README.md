# 컨트랙트 이벤트

> 솔리디티로 작성한 컨트랙트를 배포하고 상태변수를 전환 혹은 조회를 하는데 
> 번번히 여러번 조회를 호출해야하는 경우 web2에서 데이터를 표현해야할때 Off Chain 네트워크의 외부 즉 중앙화된 서비스에서 로그를 조회해야 하는 경우에 사용할 수 있는 이벤트 로그 web3 === On Chain 
> 블록체인 로그를 기록해서 프론트엔드에서 이 로그를 조회할 수 있게 하면 더 효과적으로 상태의 로그를 전달해 줄 수 있다.

```js
mapping(address => unit) userl; // 이터레이터 속성을 가지고 있지 않다.
string[] users; // 조회하기위한 상태변수
```

### 이벤트란
> 이벤트는 스마트 컨트렉트에 특정 동작이 발생하면 우리가 작성한 이벤트 로그를 호출해서 블록에 로그를 기록하는 기능

### 이벤트 사용하는 목적
1. web2 환경 즉 우리가 만드는 플렛폼 웹, 게임 등등의 환경에서 조회할 로그를 전달해서 사용할 수 있다.
2. 가스비 절약. 비효율적인 상태변수를 조회용도로 선언해서 사용하는 일이 없게 한다.
3. 블록체인에 상태 로그 기록을 하는것이기 때문에 검증 가능한 로그를 작성할 수 있다. 

### 이벤트 구문
> 컨트렉트에 이벤트를 작성


```js
// 이벤트 선언
event MyEvent(address);
[예약어] [이벤트 이름][[타입] [매개변수이름], [타입][매개변수이름]]

function myBank (uint amount) public {
    // 상태변수에 카운트

    // 로직
    msg.sender

    // 이벤트 실행
    emit MyEvent(msg.sender, amount); // 로그 히스토리가 블록에 기록된다.
}

// web2에서 호출
// abi
// 컨트랙트 로그 조회
contract = new web3.eth.Contract()

// indexed
// 이벤트를 필터링 할 때 사용
event MyEvent(address indexed name, uint amount)

// 로그를 가져올 내용을 알수가 없다.
contract.getPastEvent("", {
    fromBlock : 0,
    toBlock : "latest"
})

// 내가 기록한 이벤트의 내요을 가져온다. MyEvent
```

### 이벤트 로그와 상태변수
1. 이벤트 로그는 로그 스토리지에 저장이되고 상태변수는 state trie
2. 로그는 가스비가 저렴하고 상태변수는 가스비가 비싸다
3. 목적에 맞게 사용해야한다. 로그만 쓰면 안되고, 상태변화의 이력을 관리하고 알림. 상태변수는 데이터의 검증 영구 저장
4. 트랜잭션 로그에 기록이 되기 때문에

```js
transaction {
    log : []
}
```


### 야구게임 
> 숫자야구
> 한명이 숫자를 3개를 정하고
> 1~9까지 
> 3개의 숫자를 모두 맞춘 사람이 보상을 얻는 게임이다
> 182 => 126 => 1S 1B 1O
> 우리는 숫자 3개를 맞추면 이기는 게임
> 게임의 횟수는 관리자가 정할수 있고
> 정해진 횟수 만큼 게임을 시도하는데 못맞추면 관리자가 모든 이더를 가져간다
> 이더리움은 쌓이다가 정답을 맞춘 사람은 보상을 모든 사람이 걸어두었던 이더를 가져올 수 있다.

> 관리자가 게임을 다시 시작하는것
> 관리자가 게임 횟수를 정할 수 있고, 횟수가 다 끝나서 게임 오버 상태가 되면 관리자가 게임을 시작할때 쌓여있던 이더 회수 or 계속 못맞추면 쌓여
