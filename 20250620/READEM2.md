# 이더리움 네트워크 (Ethereum Network) 이해하기
이더리움은 비트코인이 이룩한 블록체인 기술을 바탕으로, 단순한 화폐 전송을 넘어 탈중앙화된 애플리케이션(DApp) 개발을 위한 플랫폼을 목표로 탄생했습니다. 비탈릭 부테린은 비트코인의 한계를 인지하고, 게임 아이템 소실 같은 경험을 통해 더 복잡하고 다양한 기능을 블록체인 위에서 구현할 필요성을 느꼈습니다. 이더리움 백서의 제목처럼, 이더리움은 '차세대 스마트 컨트랙트와 탈중앙화된 어플리케이션 플랫폼'을 지향합니다.
---

## 1. 비트코인 vs. 이더리움: 목적과 역할의 차이
비트코인이 **'디지털 화폐'**로서의 가치 저장 및 전송에 초점을 맞췄다면, 이더리움은 이를 넘어선 **'플랫폼'**입니다.

구분	비트코인 네트워크	이더리움 네트워크
목표	화폐(가치 저장 및 전송)	탈중앙화 애플리케이션(DApp) 플랫폼
트랜잭션	UTXO 기반의 간단한 스크립팅만 가능 (돈 송금에 특화)	상태 변환 시스템 기반, 복잡한 로직 구현 가능 (플랫폼 개발)
핵심 기술	공개키를 통한 잔액 조회 및 단순 스크립팅	스마트 컨트랙트 및 EVM을 통한 복잡한 로직 실행


이더리움은 비트코인만으로는 구현하기 어려웠던 예금, 보험, 금융 상품(이자 계산), 게임 아이템 매칭과 같은 복잡한 비즈니스 로직이나 다양한 DApp을 블록체인 위에서 구현할 수 있도록 설계되었습니다.

---

## 2. 이더리움의 핵심 개념: 상태 변환 시스템과 어카운트
비트코인이 트랜잭션의 출력값(UTXO)을 통해 잔액을 관리했다면, 이더리움은 **'상태 변환 시스템(State Transition System)'**을 기반으로 합니다. 이는 마치 쇼핑몰의 상품 구매 프로세스가 '주문 접수'부터 '배송 완료'까지 여러 상태 변화를 거치는 것과 유사합니다.

이더리움에서는 이러한 '상태'를 '어카운트(Account)'라는 객체로 관리합니다. UTXO 대신 어카운트라는 개념을 사용하며, 트랜잭션이 발생할 때마다 해당 어카운트의 상태가 변화하는 방식으로 기록됩니다.

### 2.1. 이더리움 어카운트의 두 가지 유형
이더리움에는 크게 두 가지 종류의 어카운트가 있습니다.

1. 외부 소유 계정 (EOA: Externally Owned Account):

- 사용자가 직접 관리하는 지갑입니다.
- 개인키를 가지고 있어 트랜잭션에 서명하고 발생시킬 수 있습니다.
- nonce (계정이 발생시킨 트랜잭션의 횟수, 이중 지불 방지)와 balance (이더 잔액) 정보를 가집니다.
- 오직 EOA만이 트랜잭션을 발생시킬 수 있습니다.

2. 컨트랙트 계정 (CA: Contract Account):

- 블록체인에 배포된 스마트 컨트랙트의 주소입니다.
- 개인키가 없으므로 직접 트랜잭션을 발생시킬 수 없습니다. 대신 EOA로부터 트랜잭션을 받아 스마트 컨트랙트 내부의 로직을 실행하는 '메시지 호출'을 합니다.
- nonce, balance 외에 storageRoot (컨트랙트의 상태 데이터를 저장하는 공간)와 codeHash (배포된 스마트 컨트랙트의 바이트 코드 해시) 정보를 가집니다.
- storageRoot: 컨트랙트의 특정 상태 값을 영구적으로 저장하고 검증하는 공간입니다. 예를 들어, 스마트 컨트랙트로 구현된 쇼핑몰의 '주문 상태'가 여기에 기록되어 변조 불가능한 데이터가 됩니다.
- codeHash: 스마트 컨트랙트 코드가 바이트 코드로 변환되어 블록체인에 기록된 해시 값입니다.

```TypeScript

interface Account {
    nonce: number;       // 계정이 발생시킨 트랜잭션 횟수 (이중 지불 방지)
    balance: string;     // 이더(잔액)
    storageRoot: string; // 컨트랙트의 상태 데이터 저장 공간 (CA만 해당)
    codeHash: string;    // 컨트랙트 코드의 해시 값 (CA만 해당)
}
```
---

## 3. 스마트 컨트랙트와 이더리움 가상 머신 (EVM)
이더리움의 핵심 기능은 스마트 컨트랙트입니다. 비트코인의 제한적인 스크립팅과 달리, 스마트 컨트랙트는 **'튜링 완전(Turing-complete)'**한 프로그래밍 언어로 작성되어 복잡한 연산, 조건문, 반복문 등을 포함한 모든 계산을 가능하게 합니다.

스마트 컨트랙트는 **EVM (Ethereum Virtual Machine)**이라는 런타임 환경에서 실행됩니다. EVM은 스마트 컨트랙트 코드를 바이트 코드로 변환하여 실행하며 다음과 같은 특징을 가집니다.

- 격리성: EVM은 스마트 컨트랙트 코드를 시스템으로부터 완벽하게 격리하여 실행합니다. 이는 악의적인 코드로부터 네트워크를 보호하고 안정성을 높입니다.
- 결정성: 동일한 입력에 대해 모든 노드에서 항상 동일한 결과가 나오도록 보장하여 네트워크의 합의를 유지합니다.
- 가스 메커니즘: 무한 루프나 과도한 연산으로 네트워크를 마비시키는 것을 방지하기 위해, 스마트 컨트랙트 실행에 필요한 계산량에 비례하여 **'가스(Gas)'**라는 수수료를 부과합니다.

### 3.1. 스마트 컨트랙트 실행 흐름
1. 사용자(EOA)가 스마트 컨트랙트(CA) 함수를 호출하는 트랜잭션을 생성합니다.
2. 이 트랜잭션이 블록에 포함되고, EVM이 실행을 트리거합니다.
3. EVM은 트랜잭션의 data 필드에서 호출하려는 컨트랙트 함수와 매개변수를 해석합니다.
4. EVM은 컨트랙트의 바이트 코드를 명령어(opcode) 단위로 하나씩 해석하고, **스택(임시 연산 데이터), 메모리(휘발성 중간 데이터), 저장소(영구적인 상태 데이터)**를 활용하여 계산을 수행합니다.
5. 계산 결과에 따라 컨트랙트의 storageRoot에 상태가 영구적으로 저장되고, 이 변화는 블록체인 네트워크에 전파됩니다.
6. 실행이 완료되면 소비된 가스량에 따라 수수료가 차감됩니다.
---

## 4. 트랜잭션과 메시지, 그리고 가스 (GAS)
이더리움 네트워크에서 상태를 변화시키기 위해서는 '서명'이 필수적이며, 이는 개인키를 가진 EOA만이 할 수 있습니다.

- 트랜잭션 (Transaction):   
    - 서명이 포함된 데이터 묶음입니다.
    - EOA만이 생성할 수 있습니다. 예를 들어, EOA가 다른 EOA로 이더를 보내거나, EOA가 CA의 함수를 호출할 때 발생합니다.
    - 트랜잭션은 메시지 정보를 포함하며, 추가적으로 서명 정보(v, r, s)를 가집니다.

- 메시지 (Message):

    - 서명이 없는 데이터 묶음입니다.
    - CA는 개인키가 없으므로 직접 트랜잭션을 발생시킬 수 없지만, EOA로부터 트랜잭션을 받으면 내부적으로 다른 CA를 호출하는 '메시지'를 발생시킬 수 있습니다.

``` JavaScript

// 메시지 인터페이스 (트랜잭션에 포함되는 기본 정보)
interface Message {
    from: string;    // 보내는 계정
    to: string;      // 받는 계정
    gas: number;     // 메시지 처리를 위한 최대 가스량
    gasPrice: number; // 가스당 가격 (Gwei 단위)
    value: number;   // 계정에 전달할 이더량
    data: string;    // 메시지 데이터 (컨트랙트 함수 호출 정보 등)
    nonce: number;   // 보내는 계정이 발생시킨 메시지/트랜잭션 횟수
}

// 트랜잭션 인터페이스 (메시지에 서명 정보 추가)
interface Transaction extends Message {
    v: number; // 서명 구성 요소
    r: string; // 서명 구성 요소
    s: string; // 서명 구성 요소
}
```

### 4.1. 이더리움 가스 (GAS)
가스는 EVM 상에서 트랜잭션이나 스마트 컨트랙트를 실행할 때 소모되는 컴퓨팅 자원의 단위입니다. 모든 연산에는 정해진 가스 비용이 있으며, 코드가 복잡할수록 더 많은 가스를 소모합니다.

- 가스비 계산: 가스량 (소비된 가스) * 가스 가격 (Gwei)으로 계산됩니다.
- 가스 가격: 사용자가 설정할 수 있으며, 가스 가격이 높을수록 트랜잭션이 더 빠르게 처리될 가능성이 높습니다 (네트워크의 혼잡도에 따라 영향을 받음).
- 단위: 이더리움의 화폐 단위인 이더(ETH)는 매우 작은 단위로 나뉘며, Gwei는 가스 비용을 계산하기 위한 주요 단위입니다. (1 ETH = 1,000,000,000 Gwei)
